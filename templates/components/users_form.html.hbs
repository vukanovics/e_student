{{! vim: set ft=html: }}

<div class="overflow-x-auto overflow-hidden lg:w-fit w-[90vw]">
  <form action="" method="post">
    <table class="border-spacing-0">
      <tr>
        {{! Filters }}
        <th class="align-bottom">
          {{> components/label id="filer_first_name" text=(i18n "Име")}}
          {{> components/input_cell_text icon="la-user" border="border-ccuser" class="bg-ccuser" field_name=(concat form_name ".filter_first_name") value=data.form.filter_first_name}}
          {{> components/input_select_sort field_name=(concat form_name ".sort_first_name") previous=data.form.sort_first_name border="border-ccuser" class="bg-ccuser"}}
        </th>
        <th class="align-bottom">
          {{> components/label id="filter_last_name" text=(i18n "Презиме")}}
          {{> components/input_cell_text icon="la-users" border="border-ccuser" class="bg-ccuser" field_name=(concat form_name ".filter_last_name") value=data.form.filter_last_name}}
          {{> components/input_select_sort field_name=(concat form_name ".sort_last_name") previous=data.form.sort_last_name border="border-ccuser" class="bg-ccuser"}}
        </th>
        <th class="align-bottom">
          {{> components/label id="filter_email" text=(i18n "Имејл адреса")}}
          {{> components/input_cell_text icon="la-envelope" border="border-ccemail" class="bg-ccemail" field_name=(concat form_name ".filter_email") value=data.form.filter_email}}
          {{> components/input_select_sort field_name=(concat form_name ".sort_email") previous=data.form.sort_email border="border-ccemail" class="bg-ccemail"}}
        </th>
        <th class="align-bottom">
          {{> components/checkbox border="border-ccacctype" color="text-ccacctype" bg="bg-icon" field_name=(concat form_name ".filter_account_type_enabled") text=(i18n "Филтрирај према типу налога") value=data.form.filter_account_type_enabled}}
          {{> components/input_select_account_type field_name=(concat form_name ".filter_account_type") previous=data.form.filter_account_type icon="la-user-circle" border="border-ccacctype" class="bg-ccacctype" text=(i18n "Тип налога")}}
          {{> components/input_select_sort field_name=(concat form_name ".sort_account_type") previous=data.form.sort_account_type border="border-ccacctype" class="bg-ccacctype"}}
        </th>
        <th class="align-bottom">
          {{> components/label id="index-input" text=(i18n "смер/број/година")}}
          <div id="index-input" class="flex flex-row flex-shrink w-[12rem]">
            {{> components/input_cell_text border="border-ccprog" class="bg-ccprog" field_name=(concat form_name ".filter_program") value=data.form.filter_program}}
            {{> components/input_cell_text border="border-ccuser" class="bg-ccuser" field_name=(concat form_name ".filter_index_number") value=data.form.filter_index_number}}
            {{> components/input_cell_text border="border-cctime" class="bg-cctime" field_name=(concat form_name ".filter_generation") value=data.form.filter_generation}}
          </div>
          {{> components/input_select_sort field_name=(concat form_name ".sort_index") previous=data.form.sort_index border="border-ccuser" class="bg-ccuser"}}
        </th>
        <th class="min-h-full align-bottom">
          {{> components/button_table button_text=(i18n "Примени")}}
        </th>
      </tr>
        {{#if data.control_type.Edit}}
          {{#each data.control_type.Edit.users}}
          <tr class="h-full">
            <td class="h-full">
              {{#if this.first_name}}
                {{> components/cell_text text=this.first_name}}
              {{else}}
                {{> components/cell_text text=(i18n "Није намештено")}}
              {{/if}}
            </td>
            <td class="h-full">
              {{#if this.last_name}}
                {{> components/cell_text text=this.last_name}}
              {{else}}
                {{> components/cell_text text=(i18n "Није намештено")}}
              {{/if}}
            </td>
            <td class="h-full">{{> components/cell_text text=this.email}}</td>
            <td class="h-full">{{> components/cell_text text=this.account_type}}</td>
            <td class="h-full">
              {{#if this.index}}
                {{> components/cell_text text=(concat this.program.short_name this.index.number "/" this.generation.year)}}
              {{else}}
                {{> components/cell_text text=(i18n "Нема број индекса")}}
              {{/if}}
            </td>
            <td class="flex flex-row items-center w-[32rem] lg:w-64">
              {{> components/button_link_table button_href=(concat "users/delete/" this.id) button_text="Delete"}}
              {{> components/button_link_table button_href=(concat "users/edit/" this.id) button_text="Edit"}}
            </td>
          </tr>
          {{/each}}
        {{/if}}
        {{#if data.control_type.Enrol}}
          {{#each data.control_type.Enrol.users}}
          <tr class="h-full">
            <td class="h-full">
              {{#if this.first_name}}
                {{> components/cell_text text=this.first_name}}
              {{else}}
                {{> components/cell_text text=(i18n "Није намештено")}}
              {{/if}}
            </td>
            <td class="h-full">
              {{#if this.last_name}}
                {{> components/cell_text text=this.last_name}}
              {{else}}
                {{> components/cell_text text=(i18n "Није намештено")}}
              {{/if}}
            </td>
            <td class="h-full">{{> components/cell_text text=this.email}}</td>
            <td class="h-full">{{> components/cell_text text=this.account_type}}</td>
            <td class="h-full">
              {{#if this.index}}
                {{> components/cell_text text=(concat this.program.short_name this.index.number "/" this.generation.year)}}
              {{else}}
                {{> components/cell_text text=(i18n "Нема број индекса")}}
              {{/if}}
            </td>
            <td class="flex flex-row items-center w-[32rem] lg:w-64">
              <input type="text" name={{concat ../form_name ".enrol_dropdowns." @index ".user"}} value={{this.id}} hidden>
              <input type="text" name={{concat ../form_name ".enrol_dropdowns." @index ".old_value"}} value={{#if this.is_enrolled}}"on"{{else}}"off"{{/if}} hidden>
              <select name={{concat ../form_name ".enrol_dropdowns." @index ".new_value"}}>
                <option value="on" {{#if this.is_enrolled}}selected{{/if}}>Enrolled</option>
                <option value="off"{{#unless this.is_enrolled}}selected{{/unless}}>Not enrolled</option>
              </select>
            </td>
          </tr>
          {{/each}}
        {{/if}}
      </table>
    </div>
    <div class="flex">
      <p>Current page:</p>
      <select name={{concat form_name ".page"}}>
        {{#each (range 0 1 data.number_of_pages)}}
          <option value="{{this}}" {{#if (eq ../data.form.page this)}}selected{{/if}}>{{this}}</option>
        {{/each}}
      </select>
      <p>Show this many per page:</p>
      <select name={{concat form_name ".max_per_page"}}>
        {{#each (range 10 5 50)}}
          <option value="{{this}}" {{#if (eq ../data.form.max_per_page this)}}selected{{/if}}>{{this}}</option>
        {{/each}}
      </select>
    </div>
  </form>
</div>